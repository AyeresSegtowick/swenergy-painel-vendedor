<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel do Vendedor - SW Energy</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header>
  <div class="logos">
    <img src="logo sw.png" alt="Logo SW Energy" />
  </div>
  <div><strong>Painel de Vendas</strong></div>
</header>

<div id="loginArea">
  <h2>Login do Vendedor</h2>
  <input type="text" id="usuario" placeholder="Nome do vendedor" autocomplete="username" />
  <input type="password" id="senha" placeholder="Senha" autocomplete="current-password" />
  <button onclick="logar()">Entrar</button>
</div>

<div id="painel" style="display:none;">
  <h2>Bem-vindo, <span id="nomeVendedor"></span></h2>
  <table>
    <thead>
      <tr>
        <th>Data</th>
        <th>Cliente</th>
        <th>kWh</th>
        <th>Comissão (R$)</th>
      </tr>
    </thead>
    <tbody id="dadosTabela"></tbody>
  </table>
  <button onclick="logout()">Sair</button>
</div>

<script>
  const API_LOGIN_URL = "https://sheetdb.io/api/v1/i3mmwap91vgg4";
  const API_DADOS_URL = "https://sheetdb.io/api/v1/l8mnon8vtbghj";

  async function logar() {
    const usuario = document.getElementById("usuario").value.trim().toLowerCase();
    const senha = document.getElementById("senha").value;

    if (!usuario || !senha) {
      alert("Preencha usuário e senha.");
      return;
    }

    try {
      const res = await fetch(API_LOGIN_URL);
      const usuarios = await res.json();
      const user = (usuarios.data || usuarios).find(u => u.usuario?.toLowerCase() === usuario);

      if (!user) return alert("Usuário não encontrado.");
      if (user.senha !== senha) return alert("Senha incorreta.");

      document.getElementById("loginArea").style.display = "none";
      document.getElementById("painel").style.display = "block";
      document.getElementById("nomeVendedor").innerText = user.usuario;
      carregarDadosVendedor(usuario);
    } catch (err) {
      console.error(err);
      alert("Erro no login.");
    }
  }

  async function carregarDadosVendedor(usuario) {
    try {
      const res = await fetch(API_DADOS_URL);
      const dados = await res.json();
      const lista = dados.data || dados;
      const tabela = document.getElementById("dadosTabela");
      tabela.innerHTML = "";

      const registros = lista.filter(r => r.vendedor?.toLowerCase() === usuario);

      if (registros.length === 0) {
        tabela.innerHTML = "<tr><td colspan='4'>Nenhum registro encontrado.</td></tr>";
        return;
      }

      registros.forEach(row => {
        const comissao = parseFloat((row.comissao_reais || "0").replace(",", ".")) || 0;
        tabela.innerHTML += `
          <tr>
            <td>${row.data || '-'}</td>
            <td>${row.cliente || '-'}</td>
            <td>${row.kwh || '-'}</td>
            <td>${comissao.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
          </tr>
        `;
      });
    } catch (err) {
      console.error(err);
      alert("Erro ao carregar dados.");
    }
  }

  function logout() {
    document.getElementById("loginArea").style.display = "block";
    document.getElementById("painel").style.display = "none";
    document.getElementById("usuario").value = "";
    document.getElementById("senha").value = "";
    document.getElementById("dadosTabela").innerHTML = "";
  }
</script>

</body>
</html>
